// import 'package:flutter/cupertino.dart';
// import 'package:flutter/material.dart';
// import 'package:ozan/db/db_provider.dart';
// import 'package:ozan/db/notes.dart';
// import 'package:provider/provider.dart';

// class SearchView extends StatefulWidget {
  
//   const SearchView({super.key});

//   @override
//   State<SearchView> createState() => _SearchViewState();
// }

// class _SearchViewState extends State<SearchView> {

//   @override
//   Widget build(BuildContext context) {

//     TextEditingController controller = TextEditingController();

//     List<NotesModel> results = [];

//     return Consumer<DatabaseProvider>(builder:(context, value, child) =>
      
//       AlertDialog(

//         contentPadding: EdgeInsets.zero,

//         backgroundColor: Theme.of(context).colorScheme.primary,

//         surfaceTintColor: Colors.transparent,
      
//         shadowColor: Colors.transparent,

//         shape: RoundedRectangleBorder(side: BorderSide(color: Theme.of(context).colorScheme.secondary), borderRadius: BorderRadius.circular(20)),
      
//         content:
      
//           Column(

//             mainAxisSize: MainAxisSize.min,

//             children: [

//               Container(
              
//                 alignment: Alignment.center,
              
//                 margin: const EdgeInsets.fromLTRB(30, 20, 30, 20),
              
//                 height: 50,
              
//                 width: 300,
              
//                 decoration: BoxDecoration(color: Theme.of(context).colorScheme.background, border: Border.all(color: Theme.of(context).colorScheme.secondary), borderRadius: BorderRadius.circular(20)),
                
//                 child: Row(
                  
//                   mainAxisAlignment: MainAxisAlignment.spaceBetween,
              
//                   children: [
              
//                     Expanded(child: TextField(
                                                                            
//                       controller: controller,
                    
//                       decoration: const InputDecoration(border: InputBorder.none, contentPadding: EdgeInsets.fromLTRB(16, 10, 10, 10)),
              
//                       cursorColor: Theme.of(context).colorScheme.secondary,
              
//                       cursorHeight: 28,
              
//                       style: const TextStyle(fontSize: 20),
                      
//                     )),
              
//                     Padding(
              
//                       padding: const EdgeInsets.only(right: 16),
              
//                       child: IconButton(onPressed: (){
//                         if (controller.text.isNotEmpty){
//                           setState(() async{
//                             results = await value.dbHelper.searchNotes(controller.text);
//                           });
//                         }
//                       }, icon: Icon(CupertinoIcons.search, color: Theme.of(context).colorScheme.tertiary.withOpacity(0.6),)),
//                     )
//                   ],
//                 ),
              
//               ),

//               Container(

//                 width: double.maxFinite,

//                 child: ListView.builder(
                      
//                   itemCount: results.length,
                
//                   itemBuilder:(context, index) {
                          
//                   return const Placeholder();
//                           },),
//               )
//             ],
//           ),
//       ),
//     );
//   }
// }

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:ozan/db/db_provider.dart';
import 'package:provider/provider.dart';

class SearchView extends StatefulWidget {
  const SearchView({super.key});

  @override
  State<SearchView> createState() => _SearchViewState();
}

class _SearchViewState extends State<SearchView> {
@override 
Widget build(BuildContext context) { 

  TextEditingController controller = TextEditingController();

  String query = '';
	
  return Consumer<DatabaseProvider>(builder:(context, value, child) =>

    SimpleDialog( 

      contentPadding: EdgeInsets.zero,

      backgroundColor: Theme.of(context).colorScheme.primary,

      surfaceTintColor: Colors.transparent,
      
      shadowColor: Colors.transparent,

      shape: RoundedRectangleBorder(side: BorderSide(color: Theme.of(context).colorScheme.secondary), borderRadius: BorderRadius.circular(20)),
            
      children: [

              Container(
              
                alignment: Alignment.center,
              
                margin: const EdgeInsets.fromLTRB(30, 20, 30, 20),
              
                height: 50,
              
                width: 300,
              
                decoration: BoxDecoration(color: Theme.of(context).colorScheme.background, border: Border.all(color: Theme.of(context).colorScheme.secondary), borderRadius: BorderRadius.circular(20)),
                
                child: Row(
                  
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
              
                  children: [
              
                    Expanded(child: TextField(
                                                                            
                      controller: controller,
                    
                      decoration: const InputDecoration(border: InputBorder.none, contentPadding: EdgeInsets.fromLTRB(16, 10, 10, 10)),
              
                      cursorColor: Theme.of(context).colorScheme.secondary,
              
                      cursorHeight: 28,
              
                      style: const TextStyle(fontSize: 20),

                      onSubmitted: (value) async{
                      
                      setState(() {
                          query = value;
                        });
                      },
                      
                    )),
              
                    Padding(
              
                      padding: const EdgeInsets.only(right: 16),
              
                      child: IconButton(onPressed: (){
                        
                        setState(() {
                          query = controller.text;
                        });

                      }, icon: Icon(CupertinoIcons.search, color: Theme.of(context).colorScheme.tertiary.withOpacity(0.6),)),
                    )
                  ],
                ),
              
              ),
        
        Expanded(

          child: SizedBox( 
          
          height: MediaQuery.of(context).size.height,
            
          width: MediaQuery.of(context).size.width,
            
          child: FutureBuilder(

            future: value.dbHelper.searchNotes(query),

            builder:(context, snapshot) => GridView.builder( 
            
            gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount( 
              crossAxisCount: 4, 
              childAspectRatio: 1.0, 
            ), 
              
            itemCount: snapshot.data?.length, 
                  
            itemBuilder: (context, index) { 
              
              return Container(
            
                decoration: const BoxDecoration(),
            
                child: Column(
            
                  children: [
            
                  Text(snapshot.data![index].title),
            
                  ],
                ),
              );
            }, 
            ),
          ), 
        ),
      )]),
  );
}}

